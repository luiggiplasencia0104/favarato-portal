(function($){$.timer=function(func,time,autostart){this.set=function(func,time,autostart){this.init=true;if(typeof func=="object"){var paramList=["autostart","time"];for(var arg in paramList){if(func[paramList[arg]]!=undefined){eval(paramList[arg]+" = func[paramList[arg]]")}}func=func.action}if(typeof func=="function"){this.action=func}if(!isNaN(time)){this.intervalTime=time}if(autostart&&!this.active){this.active=true;this.setTimer()}return this};this.once=function(e){var t=this;if(isNaN(e)){e=0}window.setTimeout(function(){t.action()},e);return this};this.play=function(e){if(!this.active){if(e){this.setTimer()}else{this.setTimer(this.remaining)}this.active=true}return this};this.pause=function(){if(this.active){this.active=false;this.remaining-=new Date-this.last;this.clearTimer()}return this};this.stop=function(){this.active=false;this.remaining=this.intervalTime;this.clearTimer();return this};this.toggle=function(e){if(this.active){this.pause()}else if(e){this.play(true)}else{this.play()}return this};this.reset=function(){this.active=false;this.play(true);return this};this.clearTimer=function(){window.clearTimeout(this.timeoutObject)};this.setTimer=function(e){var t=this;if(typeof this.action!="function"){return}if(isNaN(e)){e=this.intervalTime}this.remaining=e;this.last=new Date;this.clearTimer();this.timeoutObject=window.setTimeout(function(){t.go()},e)};this.go=function(){if(this.active){this.action();this.setTimer()}};if(this.init){return new $.timer(func,time,autostart)}else{this.set(func,time,autostart);return this}};$.fn.polyglotLanguageSwitcher=function(e){function h(e){if(f[e.name]){f[e.name].call($(this),e)}}function p(){if(!u){h({name:"beforeOpen",element:n,instance:t});i.addClass("active");g(true);setTimeout(function(){u=true;h({name:"afterOpen",element:n,instance:t})},100)}}function d(){if(u){h({name:"beforeClose",element:n,instance:t});g(false);i.removeClass("active");u=false;if(l&&l.active){l.clearTimer()}h({name:"afterClose",element:n,instance:t})}}function v(){if(l&&l.active){l.pause()}}function m(){if(l){l.play(false)}}function g(e){if(f.effect=="fade"){if(e){s.fadeIn(f.animSpeed)}else{s.fadeOut(f.animSpeed)}}else{if(e){s.slideDown(f.animSpeed)}else{s.slideUp(f.animSpeed)}}}function y(e){d();var t=$(e).children(":first-child");var n=$(t).attr("id");var r=$(t).text();$(s).children().each(function(){$(this).detach()});for(var o=0;o<a.length;o++){if($(a[o]).children(":first-child").attr("id")!=n){s.append(a[o])}}var u=i.children(":first-child");i.attr("id",n);i.text(r);i.append(u)}function b(){$(document).click(function(){d()});$(document).keyup(function(e){if(e.which==27){d()}});if(f.openMode=="hover"){l=$.timer(function(){d()});l.set({time:f.hoverTimeout,autostart:true})}}function w(){var e;var t=$("#"+r+" > form > select > option");if(c){var u;var l=window.location.href;t.each(function(){var e=$(this).attr("id");if(l.indexOf("/"+e+"/")>=0){u=e}})}t.each(function(){var t=$(this).attr("id");var n;if(c){n=u===t}else{n=$(this).attr("selected")}var r=E($(this));if(n){e=r}a.push(r);if(o>0){s.append(r)}else{i=$('<a id="'+$(this).attr("id")+'" class="current" href="javascript:void(0);">'+$(this).text()+' <span class="trigger">&raquo;</span></a>');if(f.openMode=="hover"){i.hover(function(){p();v()},function(){m()})}else{i.click(function(){p()})}}o++});$("#"+r+" form:first-child").remove();n.append(i);n.append(s);if(e){y(e)}}function E(e){var r=$(e).attr("id");var i=$(e).attr("value");var s=$(e).text();var o;if(c){var u=window.location.href;var a=u.substring(u.lastIndexOf("/")+1);var l="http://"+document.domain+"/"+f.pagePrefix+r+"/"+a;o=$('<li><a id="'+r+'" href="'+l+'">'+s+"</a></li>")}else{var p=document.URL.replace("#","");var d=S();d[f.paramName]=i;if(p.indexOf("?")>0){p=p.substring(0,p.indexOf("?"))}p+=x(d);o=$('<li><a id="'+r+'" href="'+p+'">'+s+"</a></li>")}o.bind("click",function(){h({name:"onChange",selectedItem:$(this).children(":first").attr("id"),element:n,instance:t});y($(this))});if(f.openMode=="hover"){o.hover(function(){v()},function(){m()})}return o}function S(){var e={};var t=window.location.search.substr(1).split("&");if(t.length>0){for(var n=0;n<t.length;++n){var r=t[n].split("=");if(r.length!=2){continue}e[r[0]]=decodeURIComponent(r[1].replace(/\+/g," "))}}return e}function x(e){if(f.testMode){return"#"}else{var t="?";var n=0;for(var r in e){var i="";if(n>0){i="&"}t+=i+r+"="+e[r];n++}return t}}var t=$.fn.polyglotLanguageSwitcher;var n=$(this);var r=$(this).attr("id");var i;var s=$('<ul class="dropdown">');var o=0;var u=false;var a=[];var f=$.extend({},t.defaults,e);var l;var c=f.websiteType=="static";w();b();t.open=function(){p()};t.close=function(){d()};h({name:"afterLoad",element:n,instance:t});return t};var ls=$.fn.polyglotLanguageSwitcher;ls.defaults={openMode:"click",hoverTimeout:1500,animSpeed:200,effect:"slide",paramName:"lang",pagePrefix:"",websiteType:"dynamic",testMode:false,onChange:NaN,afterLoad:NaN,beforeOpen:NaN,afterOpen:NaN,beforeClose:NaN,afterClose:NaN}})(jQuery)